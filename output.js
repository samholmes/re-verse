function createScope(i){var e={},t=function(n,r){if(r){var o=new Thing(n,r.items,r.keys);return o.signature=r.signature,o.body=r.body,o.definitionScope=t,e[n]=o}var r;return r=e[n],r||(r="function"==typeof i?i(n):new Thing(n,[],{})),r};return t}function Thing(i,e,t){Array.isArray(i)||(i=[i]);var n=i[i.length-1];this.items=e||[],this.keys=t||{},this.identifiers=i,this.identifier=n}function destructure(i,e,t){i.identifiers.forEach(function(n,r){if(e.keys[n])var o=e.keys[n];else if(e.items[r])var o=e.items[r];else if(i.keys[n])var o=i.keys[n];else if(n===i.identifier)var o=i.items[0];var s=new Thing(n,[o]);t(n,s)})}function error(i){throw new Error("Runtime Error: "+i)}var scope=createScope();Thing.prototype.is=function(i,e){return e(this.identifier,i)},Thing.prototype.and=function(i){var e=new Thing([this.identifier,i.identifier]);return e.items=this.items.concat(i.items),e.keys=Object.assign(this.keys,i.keys),e},Thing.prototype.as=function(i){var e=new Thing(this.identifier);return e.keys[i.identifier]=this,e},Thing.prototype["in"]=function(i){var e=i.keys[this.identifier];return e||(e=new Thing(null,[])),e},Thing.prototype.to=function(i){if("function"==typeof i.body){inputThing=this;var e=createScope(i.definitionScope);if("function"==typeof i.signature){var t=i.signature(i.definitionScope);t&&destructure(t,inputThing,e)}return i.body(e)}error(i.identifier+" is not a function.")},Thing.prototype.lambda=function(i,e){return this.signature=i,this.body=e,this};
// END OF RUNTIME

!function(n){function t(n,t){return new Thing(null).lambda(n,t)}function o(n){var o=(n.toString().match(/\((.+?)\)/)||[])[1],r=o?o.split(/\s*,\s*/):[],i=u(r),c=function(t){var o=[];return r.forEach(function(n){o.push(t(n).items[0])}),n.apply(this,o)};return t(i,c)}function u(n){return function(t){return n.reduce(function(n,o){return n=n?n.and(t(o)):new Thing(o)},null)}}n("log",t(u(["x"]),function(n){console.log(n("x"))})),n("print",o(function(n){console.log(n)}))}(scope);
// END OF NATIVE

(new Thing(null, ["Hello world"],{})).to(scope("print"));
